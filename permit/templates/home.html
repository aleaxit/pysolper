<html>
  <head>
    <title>Solar Permitting for {{ main.jurisdiction|e }}</title>
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/themes/sunny/jquery-ui.css" type="text/css" />
    <link rel="stylesheet" href="/static/tablesorter.blue/style.css" type="text/css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js">
    </script>
    <script src="/static/jquery.tablesorter.min.js">
    </script>
    <script>
      var emailPattern = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
      $(function() {
        $('.button').button()
        $('#login-form').submit(function() {
          var input = $('#login-email').val();
          if (emailPattern.test(input)) {
            return true;
          } else {
            $('#email-input-error').show();
            return false;
          }
        });
        $('table.tablesorter').tablesorter({headers: {5: {sorter: false}}});
      });
    </script>
    <style>
      body {
      width: 950px;
      border: 5px solid yellow;
      font-size: 1.2em;
      }
      #email-input-error {
      display: none;
      }
      .error {
      font-size: smaller;
      color: red;
      }
      .login-box {
      float: right;
      background-color: #ddf;
      min-height: 150px;
      min-width: 250px;
      border: 2px solid blue;
      text-align: center;
      vertical-align: middle;
      margin: 10px;
      padding: 20px;
      font-size: 20px;
      }
      .list-panel {
      border: 1px solid #ccc;
      margin: 10px;
      padding: 10px;
      width: 500px;
      }
      table.tablesorter thead th.header {
      padding-right: 20px;
      }
      table.tablesorter {
      font-size: 0.8em;
      }
      .ui-button {
      margin: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Welcome to Solar Permitting for {{ main.jurisdiction|e }}</h1>

    {% if user %}
    {% if user.role %}
    <div class="login-box" id="login-complete">
      <p>
	You are logged in as <strong>{{ user.email|e }}</strong>
      </p>
      <p>
	Your role is {{ user.role|e }}
      </p>
      <p>
	<a class="button" href="?logout=1">Logout</a>
    </div>
    {% else %}
    <div class="login-box" id="login-choose-role">
      <p>
	You are logged in as <strong>{{ user.email|e }}</strong> 
	but your registration will be complete once you choose a role.
      </p>
      <form>
      <select name="role">
	{% for role in roles %}
	<option value="{{ role }}">{{ role }}</option>
	{% endfor %}
      </select>
      <br/>
      <input type="submit" class="button" value="Continue" />
      </form>
    </div>
    {% endif %}
    {% else %}
    <div class="login-box">
      Sign in with your
      <br/>
      <strong>Email Address:</strong>
      <form id="login-form" action="">
	<span id="email-input-error" class="error">
	  Invalid email address, please fix. 
	</span>
	<input name="email" id="login-email" type="text" size="30" />
	<input type="submit" class="button" value="Continue" />
      </form>
    </div>
    {% endif %}

    {% if user.role == "Applicant" %}
    <div id="start-new-case">
      <a href="/case/new" id="start-new-case-button" class="button">
	Start a new Case
      </a>
    </div>

    </div>
    <div id="cases-in-progress" class="list-panel">
      You have N cases in progress.  
      The most recently modified ones appear first.

      <table class="tablesorter" id="cases"> 
	<thead>
	  <tr>
	    <th>
	      Case Name
	    </th>
	    <th>
	      Creation Date
	    </th>
	    <th>
	      Status
	    </th>
	    <th>
	      Latest Action
	    </th>
	    <th>
	      Latest Action Date
	    </th>
	    <th>
	      Edit
	    </th>
	  </tr>
	</thead>
	<tbody>
	  <tr>
	    <td>
	      123 Elm Street, City of Light
	    </td>
	    <td>
	      April 1, 2011
	    </td>
	    <td>
	      Pending Approval by City of Light
	    </td>
	    <td>
	      Submitted by 
	    </td>
	    <td>
	      July 4, 2011
	    </td>
	    <td>
	      <a href="#TODO" class="button">Edit</a>
	    </td>
	  </tr>
	  <tr>
	    <td>
	      456 Oak Drive, City of Light
	    </td>
	    <td>
	      April 3, 2011
	    </td>
	    <td>
	      Approved by City of Light
	    </td>
	    <td>
	      Approved by City
	    </td>
	    <td>
	      July 5, 2011
	    </td>
	    <td>
	      <a href="#TODO" class="button">Edit</a>
	    </td>
	  </tr>
	</tbody>
      </table>

      </div>
    </div>
    {% endif %}
  </body>
</html>
